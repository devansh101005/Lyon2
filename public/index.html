<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lyon</title>

  <!-- Fonts & Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="logoo.png">
</head>

<body>
  <!-- Landing Page -->
  <div class="card fade active" id="landing">
    <img src="logoo.png" alt="Lyon Logo" class="logo">
    <h1>SNU's First Swiping Matchmaking</h1>
    <p>Find your perfect prom partner across campus!</p>
    <button class="btn" onclick="showForm()">Get Started ğŸ’–</button>
  </div>

  <!-- Form Page -->
 <!-- Form Page -->
<div class="card fade" id="form-page">
  <h1>Set Up Profile</h1>

 <form action="/upload" method="POST" enctype="multipart/form-data" class="form" onsubmit="return handleSubmit(event)">


    <label for="username">Your Name:</label>
    <input type="text" id="username" name="name" placeholder="Enter your name" required>

    <label for="snuId">Email:</label>
    <input type="email" id="snuId" name="email" placeholder="Enter your email" required>

    <label for="photoUpload">Upload your photo:</label>
    <input type="file" id="photoUpload" name="image" accept="image/*" onchange="previewPhoto(event)" required>

    <div id="previewContainer" style="display:none; text-align:center; margin:10px 0;">
      <img id="previewImage" src="" alt="Preview" class="profile-preview">
    </div>

    <label for="bio">Bio (optional):</label>
    <textarea id="bio" name="bio" placeholder="Write a short bio" rows="2"></textarea>
    <label for="gender">Gender:</label>
<select id="gender" name="gender" required>
  <option value="">Select gender</option>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>


    <button class="btn" type="submit">Submit Profile</button>
  </form>
  <div id="profileDisplay"></div>

</div>


  <!-- My Profile Page -->
  <div class="card fade" id="my-profile">
    <h1>Your Profile âœ¨</h1>
    <div class="user-card large" id="myProfileCard"></div>
    <div>
      <button class="btn" onclick="showBrowse()">Continue to Browse ğŸ’ƒğŸ•º</button>
    </div>
  </div>

  <!-- Browse Page -->
  <div class="card fade" id="browse">
    <h1>People Looking for a Prom Partner ğŸ’ƒğŸ•º</h1>
    <div class="swipe-container">
      <div id="currentUserCard" class="user-card large"></div>
      <div class="swipe-buttons">
        <button class="btn small dislike" onclick="nextUser()">âŒ</button>
        <button class="btn small like" onclick="likeUser()">â¤</button>
      </div>
    </div>
  </div>

  <footer>Made with â¤ by Team Lyon</footer>

  <!-- Script -->
  <script>
const BASE_URL = "https://lyon2.onrender.com";


function previewPhoto(event) {
  const previewContainer = document.getElementById("previewContainer");
  const previewImage = document.getElementById("previewImage");

  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    previewImage.src = e.target.result;
    previewContainer.style.display = "block";
  };
  reader.readAsDataURL(file);
}


let users = [];
let currentIndex = 0;

// âœ… Show Form Page
function showForm() {
  switchPage("form-page");
}

// âœ… Page Switcher Utility
function switchPage(pageId) {
  const allPages = document.querySelectorAll(".card");
  allPages.forEach(page => page.classList.remove("active"));
  document.getElementById(pageId).classList.add("active");
}

// âœ… Load Users
async function loadUsers() {
  try {
    const gender = document.getElementById("gender").value;
    const res = await fetch(`${BASE_URL}/users?gender=${gender}`);
    users = await res.json();

    if (users.length === 0) {
      alert("No profiles found yet ğŸ˜¢");
      return;
    }

    showBrowse();
  } catch (err) {
    console.error("âŒ Error loading users:", err);
    alert("Failed to load users from the database.");
  }
}

// âœ… Like Functionality
function likeUser() {
  const card = document.getElementById("currentUserCard");
  card.classList.add("swipe-right");

  const heart = document.createElement("div");
  heart.classList.add("floating-heart");
  heart.innerHTML = "â¤";
  document.body.appendChild(heart);

  const likerEmail = document.getElementById("snuId")?.value;
  const likedEmail = users[currentIndex]?.email;

  if (likerEmail && likedEmail) {
    fetch(`${BASE_URL}/like`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ liker_email: likerEmail, liked_email: likedEmail })
    })
    .then(res => res.text())
    .then(msg => console.log("âœ… " + msg))
    .catch(err => console.error("âŒ Error sending like:", err));
  }

  setTimeout(() => heart.remove(), 1000);
  setTimeout(() => {
    alert("You liked " + users[currentIndex].name + " ğŸ’–");
    currentIndex++;
    card.classList.remove("swipe-right");
    showUser();
  }, 400);
}

// âœ… Show Browse Page
function showBrowse() {
  switchPage("browse");
  currentIndex = 0;
  showUser();
}

// âœ… Show Current User
function showUser() {
  const user = users[currentIndex];
  const container = document.getElementById("currentUserCard");
  const buttons = document.querySelector(".swipe-buttons");

  if (!user) {
    container.innerHTML = "<p>No more users available ğŸ’”</p>";
    buttons.style.display = "none";
    return;
  }

  buttons.style.display = "flex";
  container.innerHTML = `
    <img src="${BASE_URL}/uploads/${user.image}" alt="">
    <h2>${user.name}</h2>
    <p>${user.bio}</p>
  `;
}

// âœ… Handle Profile Submission
function handleSubmit(event) {
  event.preventDefault();
  const form = event.target;
  const formData = new FormData(form);

  fetch(`${BASE_URL}/upload`, {
    method: "POST",
    body: formData,
  })
    .then(async (res) => {
      const data = await res.json();
      if (res.ok) {
        alert(data.message);
        const user = data.user;
        document.getElementById("profileDisplay").innerHTML = `
          <div style="text-align:center; margin-top:20px;">
            <h3>${user.name}</h3>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Bio:</strong> ${user.bio || "No bio"}</p>
            <img src="${BASE_URL}/uploads/${user.image}" width="120" style="border-radius:10px;">
          </div>
        `;
      } else {
        alert("Error: " + data);
      }
    })
    .catch((err) => {
      console.error("âŒ Upload error:", err);
      alert("Something went wrong");
    });
}
</script>


</body>
</html>